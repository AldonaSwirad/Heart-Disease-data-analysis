---
title: "Bayes"
author: "Aldona Swirad"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

# Dane 

Zestaw danych zawiera 18 zmiennych (9 wartości logicznych, 5 ciągów znaków i 4 liczby dziesiętne). W projektach związanych z uczeniem maszynowym "HeartDisease" może być wykorzystywane jako zmienna objaśniająca, ale należy zauważyć, że klasy są silnie niezrównoważone.

Dane pobrane zostały z kaggle: <https://www.kaggle.com/code/georgyzubkov/heart-disease-exploratory-data-analysis/input>. Dane zawierają takie cechy jak:

# Opis cech:

-   **HeartDisease** - czy badany ma chorobę serca.

-   **BMI** - wartość, która pozwala ocenić stopień zgodności masy ciała osoby z jej wzrostem, a tym samym pośrednio ocenić, czy masa jest niewystarczająca, normalna czy nadmierna. Jest to ważne przy ustalaniu wskazań do konieczności leczenia.

-   **Smoking** - palenie jest głównym czynnikiem ryzyka chorób sercowo-naczyniowych. Po inhalacji dymu z papierosa reakcja układu sercowo-naczyniowego następuje natychmiastowo: w ciągu jednej minuty tempo akcji serca zaczyna wzrastać, zwiększając się o 30% w ciągu dziesięciu minut palenia. Zły nawyk również podnosi ciśnienie krwi, poziom fibrinogenu i płytek krwi, co zwiększa prawdopodobieństwo powstawania skrzepów.

-   **AlcoholDrinking** - alkohol powoduje nie tylko tymczasowe zaburzenia w funkcjonowaniu serca, ale także trwałe. Ból serca po alkoholu to nie jedyny problem zdrowotny związany z jego spożyciem.

-   **Stroke** - Udar niedokrwienny występuje 4 razy częściej niż krwotoczny. Jedną z głównych przyczyn tego cierpienia są choroby serca, które upośledzają jego funkcjonowanie, w wyniku czego przepływ krwi w tętnicach jest zakłócony, a dopływ krwi do mózgu zmniejszony. Inną przyczyną udaru w chorobach serca jest zakrzepica, gdy powstają skrzepy w jamach serca (najczęściej przy niewydolności serca) - skrzepy krwi.

-   **PhysicalHealth** - ile dni w miesiącu badany czuł się zle pod kątem zdrowia fizycznego.

-   **MentalHealth** - ile dni w miesiącu badany czuł się zle pod kątem zdrowia psychicznego.

-   **DiffWalking** - trudność w wchodzeniu po schodach.

-   **Sex** - płeć osoby.

-   **AgeCategory** - kategoria wiekowa badanych.

-   **Race** - rasa.

-   **Diabetic** - cukrzyca.

-   **PhysicalActivity** - badano, którzy zgłosili wykonywanie aktywności fizycznej lub ćwiczeń w ciągu ostatnich 30 dni oprócz swojej regularnej pracy.

-   **GenHealth** - samopoczucie.

-   **SleepTime** - liczba godzin snu.

-   **Asthma** - astma.

-   **KidneyDisease** - choroba nerek.

-   **Skin Cancer** - rak skóry.

# Instalacja i wszystywanie potrzebnych bibliotek w środowisku R

```{r echo=FALSE, results='asis'}
#install.packages("readxl")
library(readxl)
#install.packages("Rgraphviz")
#library(Rgraphviz)
#install.packages("bnlearn")
library(bnlearn)
#install.packages("gRain")
#library(gRain)
```

# Wczytywanie danych z csv

```{r echo=FALSE, results='asis'}
#cardio <- read.csv("C:\\Users\\Aldona\\Documents\\GitHub\\Heart-Disease-data-analysis\\heart_2020_cleaned.csv")
cardio <- read.csv("heart_2020_cleaned.csv")
knitr::kable(head(cardio[,c(1:7)]), "pipe", align = "ccccc")
knitr::kable(head(cardio[,c(7:15)]), "pipe", align = "ccccc")
```

# Redukcja ilości danych atrybutowych do (5-7)

```{r pressure, echo=FALSE, out.width = '100%'}
knitr::include_graphics("ktore.png")
```

Pod uwage wzięłam tylko te cechy, które mają zazwyczaj największy wpły na występowanie chorób kardiologicznych.

```{r}
# usuwam SkinCancer
cardio <- cardio[, -18]
# usuwam KidneyDisease
cardio <- cardio[, -17]
#usuwam Asthma
cardio <- cardio[, -16]
#usuwam SleepTime
cardio <- cardio[, -15]
#usuwam GenHealth
cardio <- cardio[, -14]
#usuwam Race
cardio <- cardio[, -11]
#usuwam Sex
cardio <- cardio[, -9]
#usuwam DiffWalking
cardio <- cardio[, -8]
#usuwam MentalHealth
cardio <- cardio[, -7]
#usuwam PhisicalHealth
cardio <- cardio[, -6]
knitr::kable(head(cardio), "pipe", align = "ccccc")
```
# Usuwanie wartości odstających
Wartości odstające usuwam w kolumnie BMI, reszta kolumn nie ma wartości znacząco odstających.
```{r}
#min_BMI <- min(cardio$BMI)
# 12.02
#cardio <- cardio[!cardio$BMI == min_BMI,]
#min_BMI <- min(cardio$BMI)
#####################################################
#max_BMI <- max(cardio$BMI)
# 12.02
#cardio <- cardio[!cardio$BMI == max_BMI,]
#max_BMI <- max(cardio$BMI)
# 94.85
```

# Grupowanie danych
Wiek osób badanych poddany został grupowaniu na etapie zbierania danych, więc nie wymagał dodatkowego grupowania. Grupowaniu poddany został wskaźniek BMI, zgodnie z poniższym rysunkiem.

```{r , echo=FALSE, out.width = '100%'}
knitr::include_graphics("BMI.png")
```

```{r, echo=TRUE}
min_BMI <- min(cardio$BMI)
max_BMI <- max(cardio$BMI)

BMI_groups <- cut(cardio$BMI,
                  breaks = c(min_BMI, 18.5, 25, 30, max_BMI),
                  labels = c("Niedowaga", "Norma", "Nadwaga", "Otyłość"),
                  #konieczne jest dodanie include lowest = T, gdyz bez tego wyrzuca wartości z granicy przedziału :(
                  include.lowest = TRUE
)

#usuwanie nieuzywanych poziomów
#BMI_groups <- droplevels(BMI_groups)
#BMI_groups <- as.factor(BMI_groups)
#cardio$BMI <- as.factor(cardio$BMI)
#cardio$BMI <- BMI_groups
#> anyNA(cardio)
#[1] TRUE


head(BMI_groups)
```
# Zmiana danych na czynniki
Aby możnabyło działac na danych zmieniamy ich typ na wektor.

Może trzeba będzie zmniejszyć liczbę przedziałów wieku?

```{r}
cardio$HeartDisease <- as.factor(cardio$HeartDisease)
cardio$BMI <- as.factor(BMI_groups)
cardio$Smoking <- as.factor(cardio$Smoking)
cardio$AlcoholDrinking <- as.factor(cardio$AlcoholDrinking)
cardio$Stroke <- as.factor(cardio$Stroke)
cardio$AgeCategory <- as.factor(cardio$AgeCategory)
cardio$Diabetic <- as.factor(cardio$Diabetic)
cardio$PhysicalActivity <- as.factor(cardio$PhysicalActivity)
str(cardio)
```

# Usuwanie nieużywanych poziomów
```{r}
#opcjonalne
cardio$HeartDisease <- droplevels(cardio$HeartDisease)
cardio$BMI <- droplevels(cardio$BMI)
cardio$Smoking <- droplevels(cardio$Smoking)
cardio$AlcoholDrinking <- droplevels(cardio$AlcoholDrinking)
cardio$Stroke <- droplevels(cardio$Stroke)
cardio$AgeCategory <- droplevels(cardio$AgeCategory)
cardio$Diabetic <- droplevels(cardio$Diabetic)
cardio$PhysicalActivity <- droplevels(cardio$PhysicalActivity)
```
# Dane po przerobieniu

```{r}
head(cardio)
```

```{r}
#library(bnlearn)
#if (!requireNamespace("BiocManager", quietly = TRUE))
#  install.packages("BiocManager")
#BiocManager::install(c("graph", "RBGL", "Rgraphviz"))
#a
#install.packages("gRain", dependencies=TRUE)
```

# Badanie niezależności
Badam niezależność wszystkich węzłów dzięki funkcji ci.test. Każda z tych komend testuje dwie zmienne, a wszystkie kombinacje zmiennych są uwzględnione. Zaznaczyłam, które z nich mają p-value mniejsze niż 0.05.
 
```{r}
ci.test("HeartDisease", "BMI", test = "x2", data = cardio)
ci.test("HeartDisease", "Smoking", test = "x2", data = cardio)
ci.test("HeartDisease", "AlcoholDrinking", test = "x2", data = cardio)
ci.test("HeartDisease", "Stroke", test = "x2", data = cardio)
ci.test("HeartDisease", "AgeCategory", test = "x2", data = cardio)
ci.test("HeartDisease", "Diabetic", test = "x2", data = cardio)
ci.test("HeartDisease", "PhysicalActivity", test = "x2", data = cardio)
ci.test("BMI", "Smoking", test = "x2", data = cardio)
ci.test("BMI", "AlcoholDrinking", test = "x2", data = cardio)
ci.test("BMI", "Stroke", test = "x2", data = cardio)
ci.test("BMI", "AgeCategory", test = "x2", data = cardio)
ci.test("BMI", "Diabetic", test = "x2", data = cardio)
ci.test("BMI", "PhysicalActivity", test = "x2", data = cardio)
ci.test("Smoking", "AlcoholDrinking", test = "x2", data = cardio)
ci.test("Smoking", "Stroke", test = "x2", data = cardio)
ci.test("Smoking", "AgeCategory", test = "x2", data = cardio)
ci.test("Smoking", "Diabetic", test = "x2", data = cardio)
ci.test("Smoking", "PhysicalActivity", test = "x2", data = cardio)
ci.test("AlcoholDrinking", "Stroke", test = "x2", data = cardio)
ci.test("AlcoholDrinking", "AgeCategory", test = "x2", data = cardio)
ci.test("AlcoholDrinking", "Diabetic", test = "x2", data = cardio)
ci.test("AlcoholDrinking", "PhysicalActivity", test = "x2", data = cardio)
ci.test("Stroke", "AgeCategory", test = "x2", data = cardio)
ci.test("Stroke", "Diabetic", test = "x2", data = cardio)
ci.test("Stroke", "PhysicalActivity", test = "x2", data = cardio)
ci.test("AgeCategory", "Diabetic", test = "x2", data = cardio)
ci.test("AgeCategory", "PhysicalActivity", test = "x2", data = cardio)
ci.test("Diabetic", "PhysicalActivity", test = "x2", data = cardio)


```
# Sieci
# Domyślna sieć HC
```{r}
siec_hc <- hc(cardio)
graphviz.plot(siec_hc)
```

# Domyślna sieć TABU
```{r}
siec_tabu <- tabu(cardio)
graphviz.plot(siec_tabu)
```





```{r}
 #if (!requireNamespace("BiocManager", quietly = TRUE))
 #  install.packages("BiocManager")
# BiocManager::install(c("graph", "RBGL", "Rgraphviz"))
# a
```
